## Table of contents
* [0. Back](../../readme.md#1-about)
* [3. Protocols](#3-protocols)
* [3.1 Frontend - Gateway v1.0](#31-frontend---gateway-v10)
* [3.1.1 After Connection: Handshake](#311-after-connection-handshake)
* [3.1.1.1 Success Flow](#3111-success-flow)
* [3.1.1.2 Errors](#3112-errors)

# 3. Protocols

# 3.1 Frontend - Gateway v1.0

## 3.1.1 After Connection: Handshake

### 3.1.1.1 Success Flow

After connection is established, the `Browser` needs to send handshake in this form:

Browser -> Gateway
```json
{
  "type": "handshake",
  "protocol_version": "1.0"
}
```

After that, the `Gateway` will send success handshake:

Gateway -> Browser
```json
{
  "type": "handshake",
  "result": "ok",
  "browser_id" "{uuid}"
}
```

### 3.1.1.2 Errors

On errors, the `Gateway` can send errors.

* Wrong Api version.

  The `Gateway` is not able to handle the protocol version (because it is too
  old or too new)

  Gateway -> Browser
  ```json
  {
    "type": "handshake",
    "result": "fail",
    "number": 1,
    "message": "Unsupported protocol version"
  }
  ```

* Can not create queue

  The `Gateway` can not create queue (in RabbitMQ) for screen or backend

  Gateway -> Browser
  ```json
  {
    "type": "handshake",
    "result": "fail",
    "number": 2,
    "message": "Can not create queue"
  }
  ```

* Other errors

  Gateway -> Browser
  ```json
  {
    "type": "error",
    "number": 1,
    "message": "Unsupported Gateway error"
  }
  ```
